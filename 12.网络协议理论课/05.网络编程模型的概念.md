# 05.网络编程模型的概念
- 01.客户端和服务端
  - 1.1 网络编程概念
  - 1.2 什么叫客户端
  - 1.3 什么叫服务端
  - 1.3 客户端到服务端流程
- 02.IP和端口
  - 2.1 为何需要IP和端口
  - 2.2 理解IP地址
  - 2.3 理解端口号
  - 2.4 套接字的出现
- 03.保留网段和子网
  - 3.1 保留网络是何物
  - 3.2 子网掩码是什么
- 04.全球域名系统
  - 4.1 域名解析IP
  - 4.2 DNS域名系统
  - 4.3 DNS服务分类
  - 4.4 域名解析缓存
  - 4.5 域名解析流程
  - 4.6 DNS负载均衡
- 05.数据和字节流
  - 5.1 认识数据传输
  - 5.2 TCP的应用场景
  - 5.3 UDP的应用场景
  - 5.4 套接字的设计



## 01.客户端和服务端

### 1.1 网络编程概念

在谈论网络编程时，首先需要建立一个概念，也就是今天的主题“客户端 - 服务器”。

拿我们常用的网络购物来说，我们在手机上的每次操作，都是作为客户端向服务器发送请求，并收到响应的例子。

无论是客户端，还是服务器端，它们运行的单位都是进程（process），而不是机器。

1. 一个客户端，比如我们的手机终端，同一个时刻可以建立多个到不同服务器的连接，比如同时打游戏，上知乎，逛天猫；
2. 服务器端更是可能在一台机器上部署运行了多个服务，比如同时开启了 SSH 服务和 HTTP 服务。

### 1.2 什么叫客户端

客户端相对来说更为简单，它向服务器端的监听端口发起连接请求，连接建立之后，通过连接通路和服务器端进行通信。

### 1.3 什么叫服务端

服务器端需要在一开始就监听在一个众所周知的端口上，等待客户端发送请求，一旦有客户端连接建立，服务器端就会消耗一定的计算机资源为它服务，服务器端是需要同时为成千上万的客户端服务的。

### 1.4 客户端到服务端流程

1. 当一个客户端需要服务时，比如网络购物下单，它会向服务器端发送一个请求。注意，这个请求是按照双方约定的格式来发送的，以便保证服务器端是可以理解的；

2. 服务器端收到这个请求后，会根据双方约定的格式解释它，并且以合适的方式进行操作，比如调用数据库操作来创建一个购物单；

3. 服务器端完成处理请求之后，会给客户端发送一个响应，比如向客户端发送购物单的实际付款额，然后等待客户端的下一步操作；

4. 客户端收到响应并进行处理，比如在手机终端上显示该购物单的实际付款额，并且让用户选择付款方式。

## 02.IP和端口

### 2.1 为何需要IP和端口

正如寄信需要一个地址一样，在网络世界里，同样也需要地址的概念。在 TCP/IP 协议栈中，IP 用来表示网络世界的地址。

前面我们提到了，在一台计算机上是可以同时存在多个连接的，那么如何区分出不同的连接呢？这里就必须提到端口这个概念。

拿住酒店举例子，酒店的地址是唯一的，每间房间的号码是不同的，类似的，计算机的 IP 地址是唯一的，每个连接的端口号是不同的。

### 2.2 理解IP地址

IP地址：用于标识网络中的主机或设备。IP地址可以是IPv4（例如：192.168.0.1）或IPv6（例如：2001:0db8:85a3:0000:0000:8a2e:0370:7334）格式。

### 2.3 理解端口号

端口号是一个 16 位的整数，最多为 65536。当一个客户端发起连接请求时，客户端的端口是由操作系统内核临时分配的，称为临时端口；然而，前面也提到过，服务器端的端口通常是一个众所周知的端口。

端口号是一个16位的数字，范围从0到65535。其中，0到1023的端口号被保留用于一些特定的服务，而1024到65535的端口号可以由应用程序自由使用。

### 2.4 套接字的出现

一个连接可以通过客户端 - 服务器端的 IP 和端口唯一确定，这叫做套接字对，按照下面的四元组表示：

```
（clientaddr:clientport, serveraddr: serverport)
```

## 03.保留网段和子网

### 3.1 保留网络是何物

一个比较常见的现象是，我们所在的单位或者组织，普遍会使用诸如 10.0.x.x 或者 192.168.x.x 这样的 IP 地址，你可能会纳闷，这样的 IP 到底代表了什么呢？不同的组织使用同样的 IP 会不会导致冲突呢?

背后的原因是这样的，国际标准组织在 IPv4 地址空间里面，专门划出了一些网段，这些网段不会用做公网上的 IP，而是仅仅保留作内部使用，我们把这些地址称作保留网段。

保留的私有IPv4地址范围：

```text
10.0.0.0 到 10.255.255.255
172.16.0.0 到 172.31.255.255
192.168.0.0 到 192.168.255.255
```

本地回环地址（Loopback）：本地回环地址用于在同一台计算机上进行进程间通信，用于测试和诊断网络应用程序。

```text
127.0.0.0 到 127.255.255.255
```

还有其他一些保留网段用于特殊目的，如多播地址范围（224.0.0.0 到 239.255.255.255）和广播地址（255.255.255.255），用于多播和广播通信。

在互联网协议（IP）地址空间中，被保留并不用于分配给特定设备或网络的一组IP地址。这些保留的IP地址范围被指定为特定目的，例如私有网络、回环地址、广播地址等。

这些保留网络的存在是为了确保IP地址的有效分配和避免冲突。它们有助于网络管理员和设备开发者在设计和配置网络时遵循一致的规范，并确保互联网的正常运行。

### 3.2 子网掩码是什么

在网络 IP 划分的时候，我们需要区分两个概念。

第一是网络（network）的概念，直观点说，它表示的是这组 IP 共同的部分，比如在 192.168.1.1~192.168.1.255 这个区间里，它们共同的部分是 192.168.1.0。

第二是主机（host）的概念，它表示的是这组 IP 不同的部分，上面的例子中 1~255 就是不同的那些部分，表示有 255 个可用的不同 IP。

例如 IPv4 地址，192.0.2.12，我们可以说前⾯3 个字节（byte） 是⼦⽹（subnet），最后 1 个字节是主机，或者换个⽅式，我们能说主机为 8 位，⼦⽹掩码为 192.0.2.0/24（255.255.255.0）。

具体看：https://blog.csdn.net/qq_37756660/article/details/133862522

## 04.全球域名系统
### 4.1 域名解析IP

如果每次要访问一个服务，都要记下这个服务对应的 IP 地址，无疑是一种枯燥而繁琐的事情，就像你要背下 200 多个好友的电话号码一般无聊。

正如电话簿记录了好友和电话的对应关系一样，域名（DNS）也记录了网站和 IP 的对应关系。

域名解析IP是指将域名（例如www.example.com）转换为对应的IP地址（例如192.0.2.1）的过程。

当我们在浏览器中输入一个域名时，浏览器需要将该域名解析为对应的IP地址，以便能够建立与目标服务器的连接。这个过程涉及到域名解析IP。

### 4.2 DNS域名系统

DNS是域名系统(DomainNameSystem)的缩写，该系统用于命名组织到域层次结构中的计算机和网络服务。

域名是由圆点分开一串单词或缩写组成的，每一个域名都对应一个惟一的IP地址，在Internet上域名与IP地址之间是一一对应的，DNS就是进行域名解析的服务器。

DNS命名用于Internet等TCP/IP网络中，通过用户友好的名称查找计算机和服务。DNS是因特网的一项核心服务,它作为可以将域名和IP地址相互映射的一个分布式数据库。

DNS的概念，DNS用途是干什么的？ 域名解析，www.xxx.com 转换成ip，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的ip数串。

DNS服务器，在网络世界，也是这样的。你肯定记得住网站的名称，但是很难记住网站的 IP 地址，因而也需要一个地址簿，就是DNS 服务器。

由此可见，DNS 在日常生活中多么重要。每个人上网，都需要访问它，但是同时，这对它来讲也是非常大的挑战。一旦它出了故障，整个互联网都将瘫痪。

另外，上网的人分布在全世界各地，如果大家都去同一个地方访问某一台服务器，时延将会非常大。因而，DNS服务器，一定要设置成高可用、高并发和分布式的。

### 4.3 DNS服务分类

大概可以分成这几类：

- 根 DNS 服务器 ：返回顶级域 DNS 服务器的 IP 地址
- 顶级域 DNS 服务器：返回权威 DNS 服务器的 IP 地址
- 权威 DNS 服务器 ：返回相应主机的 IP 地址

DNS服务可以分为两类：递归DNS服务用于解析用户请求的域名，而权威DNS服务用于存储和提供特定域名的IP地址和其他相关信息。

### 4.4 域名解析缓存

域名解析缓存是指在进行域名解析时，将已解析的域名和对应的IP地址暂时存储在本地系统或网络设备中，以便在后续的查询中快速获取结果，避免重复的解析过程。

域名解析缓存可以存在于多个层级，包括操作系统的本地缓存、浏览器的缓存、路由器的缓存等。不同层级的缓存具有不同的生存时间（TTL），即缓存的有效期。一旦缓存过期或被清除，系统将重新进行域名解析并更新缓存。

通过使用域名解析缓存，可以显著提高域名解析的速度和网络访问的效率，减少对DNS服务器的负载，特别是对于频繁访问相同域名的情况。

### 4.5 域名解析流程

域名解析是将人类可读的域名（如 yccoding.com）转换为计算机可理解的IP地址（如192.0.2.1）的过程。以下是域名解析的整体流程：

1. 用户输入域名：用户在浏览器或其他应用程序中输入要访问的域名，例如 yccoding.com。
2. 本地域名解析：操作系统首先会检查本地的DNS缓存，看是否已经解析过该域名。如果有缓存，且尚未过期，操作系统会直接返回缓存的IP地址，跳过后续步骤。
3. 本地域名服务器查询：如果本地缓存中没有找到对应的IP地址，操作系统会向本地配置的域名服务器（通常由ISP提供）发送DNS查询请求。本地域名服务器可能会有自己的缓存，如果有缓存，它会返回缓存的IP地址。
4. 递归查询：如果本地域名服务器没有缓存或无法提供IP地址，它会作为客户端向根域名服务器发送递归查询请求。根域名服务器是DNS系统的顶级，它存储了顶级域名服务器的地址。
5. 顶级域名服务器查询：根域名服务器收到递归查询请求后，会返回顶级域名服务器的地址给本地域名服务器。
6. 权威域名服务器查询：本地域名服务器接收到顶级域名服务器的地址后，会向顶级域名服务器发送查询请求。顶级域名服务器会返回该域名的权威域名服务器的地址。
7. 解析域名：本地域名服务器向权威域名服务器发送查询请求，权威域名服务器会返回该域名对应的IP地址。
8. 返回结果：本地域名服务器收到IP地址后，将其缓存，并将结果返回给操作系统。操作系统将IP地址返回给应用程序，如浏览器。
9. 建立连接：应用程序使用获取到的IP地址与服务器建立TCP连接，并发送HTTP请求。

### 4.6 DNS负载均衡

站在客户端角度，这是一次DNS递归查询过程。因为本地 DNS 全权为它效劳，它只要坐等结果即可。在这个过程中，DNS 除了可以通过名称映射为 IP地址，它还可以做另外一件事，就是负载均衡。

以访问“外婆家”为例。它可能有很多地址，因为它在杭州可以有很多家。所以，如果一个人想去吃“外婆家”，他可以就近找一家店，而不用大家都去同一家，这就是负载均衡。

**DNS 首先可以做内部负载均衡**。

- 例如，一个应用要访问数据库，在这个应用里面应该配置这个数据库的 IP 地址，还是应该配置这个数据库的域名呢？
- 显然应该配置域名，因为一旦这个数据库，因为某种原因，换到了另外一台机器上，而如果有多个应用都配置了这台数据库的话，一换IP地址，就需要将这些应用全部修改一遍。但是如果配置了域名，则只要在 DNS 服务器里，将域名映射为新的 IP 地址，这个工作就完成了，大大简化了运维。
- 在这个基础上可以再进一步。例如，某个应用要访问另外一个应用，如果配置另外一个应用的 IP地址，那么这个访问就是一对一的。但是当被访问的应用撑不住的时候，我们其实可以部署多个。但是，访问它的应用，如何在多个之间进行负载均衡？只要配置成为域名就可以了。在域名解析的时候，我们只要配置策略，这次返回第一个 IP，下次返回第二个 IP，就可以实现负载均衡了。

**DNS还可以做全局负载均衡**。

- 为了保证我们的应用高可用，往往会部署在多个机房，每个地方都会有自己的 IP 地址。当用户访问某个域名的时候，这个 IP 地址可以轮询访问多个数据中心。
- 如果一个数据中心因为某种原因挂了，只要在DNS 服务器里面，将这个数据中心对应的 IP 地址删除，就可以实现一定的高可用。
- 另外，我们肯定希望北京的用户访问北京的数据中心，上海的用户访问上海的数据中心，这样，客户体验就会非常好，访问速度就会超快。这就是全局负载均衡的概念。



# 参考博客

02 | 网络编程模型：认识客户端-服务器网络模型的基本概念

原文链接：https://blog.csdn.net/qq_37756660/article/details/133862522

