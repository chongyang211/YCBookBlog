#### 目录介绍
- 01.域名解析查找ip地址
- 02.DNS基础概念和用途
- 03.DNS服务器的几种分类
- 04.DNS查询的算法介绍
- 05.DNS解析流程分析说明
- 06.DNS的负载均衡是什么
- 07.解析ip地址就能通信吗
- 08.MAC地址在通信中作用



### 3.2 域名解析流程

域名解析是将人类可读的域名（如 yccoding.com）转换为计算机可理解的IP地址（如192.0.2.1）的过程。以下是域名解析的整体流程：

1. 用户输入域名：用户在浏览器或其他应用程序中输入要访问的域名，例如 yccoding.com。
2. 本地域名解析：操作系统首先会检查本地的DNS缓存，看是否已经解析过该域名。如果有缓存，且尚未过期，操作系统会直接返回缓存的IP地址，跳过后续步骤。
3. 本地域名服务器查询：如果本地缓存中没有找到对应的IP地址，操作系统会向本地配置的域名服务器（通常由ISP提供）发送DNS查询请求。本地域名服务器可能会有自己的缓存，如果有缓存，它会返回缓存的IP地址。
4. 递归查询：如果本地域名服务器没有缓存或无法提供IP地址，它会作为客户端向根域名服务器发送递归查询请求。根域名服务器是DNS系统的顶级，它存储了顶级域名服务器的地址。
5. 顶级域名服务器查询：根域名服务器收到递归查询请求后，会返回顶级域名服务器的地址给本地域名服务器。
6. 权威域名服务器查询：本地域名服务器接收到顶级域名服务器的地址后，会向顶级域名服务器发送查询请求。顶级域名服务器会返回该域名的权威域名服务器的地址。
7. 解析域名：本地域名服务器向权威域名服务器发送查询请求，权威域名服务器会返回该域名对应的IP地址。
8. 返回结果：本地域名服务器收到IP地址后，将其缓存，并将结果返回给操作系统。操作系统将IP地址返回给应用程序，如浏览器。
9. 建立连接：应用程序使用获取到的IP地址与服务器建立TCP连接，并发送HTTP请求。

### 3.3 DNS域名服务器

DNS是域名系统(DomainNameSystem)的缩写，该系统用于命名组织到域层次结构中的计算机和网络服务。

域名是由圆点分开一串单词或缩写组成的，每一个域名都对应一个惟一的IP地址，在Internet上域名与IP地址之间是一一对应的，DNS就是进行域名解析的服务器。

DNS命名用于Internet等TCP/IP网络中，通过用户友好的名称查找计算机和服务。DNS是因特网的一项核心服务,它作为可以将域名和IP地址相互映射的一个分布式数据库。

DNS的概念，DNS用途是干什么的？ 域名解析，www.xxx.com转换成ip，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的ip数串。

DNS服务器，在网络世界，也是这样的。你肯定记得住网站的名称，但是很难记住网站的 IP 地址，因而也需要一个地址簿，就是DNS 服务器。

由此可见，DNS 在日常生活中多么重要。每个人上网，都需要访问它，但是同时，这对它来讲也是非常大的挑战。一旦它出了故障，整个互联网都将瘫痪。

另外，上网的人分布在全世界各地，如果大家都去同一个地方访问某一台服务器，时延将会非常大。因而，DNS服务器，一定要设置成高可用、高并发和分布式的。

大概可以分成这几类

- 根 DNS 服务器 ：返回顶级域 DNS 服务器的 IP 地址
- 顶级域 DNS 服务器：返回权威 DNS 服务器的 IP 地址
- 权威 DNS 服务器 ：返回相应主机的 IP 地址

### 3.4 DNS解析故事

为了提高 DNS 的解析性能，很多网络都会就近部署 DNS 缓存服务器。于是，就有了以下的 DNS 解析流程。

- 1.电脑客户端会发出一个 DNS 请求，问 www.yc.com 的 IP 是啥啊，并发给本地域名服务器 (本地DNS)。那本地域名服务器 (本地 DNS) 是什么呢？如果是通过 DHCP 配置，本地 DNS 由你的网络服务商（ISP），如电信、移动等自动分配，它通常就在你网络服务商的某个机房。
- 2.本地 DNS 收到来自客户端的请求。你可以想象这台服务器上缓存了一张域名与之对应 IP 地址的大表格。如果能找到 www.yc.com，它直接就返回 IP 地址。如果没有，本地 DNS 会去问它的根域名服务器：“老大，能告诉我 www.yc.com 的 IP 地址吗？”根域名服务器是最高层次的，全球共有 13 套。它不直接用于域名解析，但能指明一条道路。
- 3.根 DNS 收到来自本地 DNS 的请求，发现后缀是 .com，说：“哦，www.yc.com 啊，这个域名是由.com 区域管理，我给你它的顶级域名服务器的地址，你去问问它吧。”
- 4.本地 DNS 转向问顶级域名服务器：“老二，你能告诉我 www.yc.com 的 IP 地址吗？”顶级域名服务器就是大名鼎鼎的比如 .com、.net、 .org 这些一级域名，它负责管理二级域名，比如163.com，所以它能提供一条更清晰的方向。
- 5.顶级域名服务器说：“我给你负责 www.yc.com 区域的权威 DNS 服务器的地址，你去问它应该能问到。”
- 6.本地 DNS 转向问权威 DNS 服务器：“您好，www.yc.com 对应的 IP 是啥呀？”163.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主。
- 7.权限 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。
- 8.本地 DNS 再将 IP 地址返回客户端，客户端和目标建立连接。





### 06.DNS的负载均衡是什么
- 站在客户端角度，这是一次DNS 递归查询过程
    - 因为本地 DNS 全权为它效劳，它只要坐等结果即可。在这个过程中，DNS 除了可以通过名称映射为 IP地址，它还可以做另外一件事，就是负载均衡。
- 以访问“外婆家”为例
    - 它可能有很多地址，因为它在杭州可以有很多家。所以，如果一个人想去吃“外婆家”，他可以就近找一家店，而不用大家都去同一家，这就是负载均衡。
- DNS 首先可以做内部负载均衡。
    - 例如，一个应用要访问数据库，在这个应用里面应该配置这个数据库的 IP 地址，还是应该配置这个数据库的域名呢？
    - 显然应该配置域名，因为一旦这个数据库，因为某种原因，换到了另外一台机器上，而如果有多个应用都配置了这台数据库的话，一换IP地址，就需要将这些应用全部修改一遍。但是如果配置了域名，则只要在 DNS 服务器里，将域名映射为新的 IP 地址，这个工作就完成了，大大简化了运维。
    - 在这个基础上可以再进一步。例如，某个应用要访问另外一个应用，如果配置另外一个应用的 IP地址，那么这个访问就是一对一的。但是当被访问的应用撑不住的时候，我们其实可以部署多个。但是，访问它的应用，如何在多个之间进行负载均衡？只要配置成为域名就可以了。在域名解析的时候，我们只要配置策略，这次返回第一个 IP，下次返回第二个 IP，就可以实现负载均衡了。
- DNS还可以做全局负载均衡。
    - 为了保证我们的应用高可用，往往会部署在多个机房，每个地方都会有自己的 IP 地址。当用户访问某个域名的时候，这个 IP 地址可以轮询访问多个数据中心。
    - 如果一个数据中心因为某种原因挂了，只要在DNS 服务器里面，将这个数据中心对应的 IP 地址删除，就可以实现一定的高可用。
    - 另外，我们肯定希望北京的用户访问北京的数据中心，上海的用户访问上海的数据中心，这样，客户体验就会非常好，访问速度就会超快。这就是全局负载均衡的概念。


### 07.解析ip地址就能通信吗
- 当网络包到达一个城关的时候，可以通过路由表得到下一个城关的IP 地址，直接通过 IP 地址找就可以了，为什么还要通过本地的 MAC 地址呢？
    - 1.mac地址是唯一的，为什么可以修改?想想身份证，身份证号是唯一的，不能改变的，但是可以造价。mac地址全球唯一，它是固化在网卡里的。网卡毕竟是个硬件，需要软件支持，既操作系统识别。重点来了，操作系统识别出来的mac地址是可以更改的，它只不过是一个字符串。我们常说的修改mac指的是修改电脑中记录的既注册表中的记录。
    - 2.有了mac地址为什么还要有ip地址。举个例子，身份证号是你的唯一标识，不会重复，一落户就有（网卡一出厂就有mac）。现在我要和你通信（写信给你），地址用你的姓名+身份证，信能送到你手上吗?明显不能！身份证号前六位能定位你出生的县。mac地址前几位也可以定位生产厂家。但是你出生后会离开这个县（哪怕在这个县，也不能具体找到你）。所以一般写个人信息就要有出生地和现居地址了。[博客](https://github.com/yangchong211/YCBlogs)


### 08.MAC地址在通信中作用
#### 8.1 MAC地址的概念
- MAC是唯一的吗
    - 理论上是不变，因为是出厂时被厂家烧在网卡上的，但是可以在网络中虚拟和伪造假的mac地址。应该没有谁为了蹭网去做那么复杂的事情，所以自己无线路由器上如果带了过滤的功能就用起来吧。
- 数据链路上只要知道了对方的MAC地址不是就可以发送数据了吗？为什么还要IP地址？
    - 一、MAC地址就好比一个人的身份证，有了身份证，你就能知道这个人在哪吗？我们需要利用IP地址来确定这个人的所在区域，在局域网中，可以使用本地的MAC地址进行通信。
    - 二、到达目标机器的局域网之后，ip就没有用了，此时需要利用MAC地址来确定目标机器。因为局域网的IP对应的机器是不固定的 ，所以，在局域网中使用IP寻址是不严谨的。
    - 三、假定MAC地址就是广播地址，那么所有接受过MAC包的路由器都会把这个消息进行转发，因此目标机器会收到很多重复的包（因为各个接受过该包的路由器都将其转发）。（为了防止上述现象的发生，目前路由器可以做到不转发那些将MAC地址作为广播地址的IP数据包）
    - 四、如果不使用IP地址，那么就需要维护一个极其庞大的MAC地址表，在查找目的机器的时候，就需要向全世界发送数据包，可想而知会造成多大的网络流量。
- MAC与IP区别，不同的特点主要有：
    - 对于网络上的某一设备，如一台计算机或一台路由器，其IP地址是基于网络拓扑设计出的，同一台设备或计算机上，改动IP地址是很容易的（但必须唯一），而MAC则是生产厂商烧录好的，一般不能改动。我们可以根据需要给一台主机指定任意的IP地址，如我们可以给局域网上的某台计算机分配IP地址为192.168.0.112 ，也可以将它改成192.168.0.200。而任一网络设备（如网卡，路由器）一旦生产出来以后，其MAC地址不可由本地连接内的配置进行修改。如果一个计算机的网卡坏了，在更换网卡之后，该计算机的MAC地址就变了。
    - 长度不同。IP地址为32位，MAC地址为48位。[博客](https://github.com/yangchong211/YCBlogs)
    - 分配依据不同。IP地址的分配是基于网络拓扑，MAC地址的分配是基于制造商。
    - 寻址协议层不同。IP地址应用于OSI第三层，即网络层，而MAC地址应用在OSI第二层，即数据链路层。 数据链路层协议可以使数据从一个节点传递到相同链路的另一个节点上（通过MAC地址），而网络层协议使数据可以从一个网络传递到另一个网络上（ARP根据目的IP地址，找到中间节点的MAC地址，通过中间节点传送，从而最终到达目的网络）。

#### 8.2 获取MAC地址
- 代码获取MAC地址，代码如下所示
    ```
    /*
     * 物理地址是48位，别和ipv6搞错了
     */
    public class LOCALMAC {
    
    	public static void main(String[] args) throws UnknownHostException, SocketException {
    		//得到IP
    		InetAddress ia = InetAddress.getLocalHost();
    		System.out.println(ia);
    		getLocalMac(ia);
    	}
    
    	private static void getLocalMac(InetAddress ia) throws SocketException {
    		////获得网络接口对象（即网卡），并得到mac地址，mac地址存在于一个byte数组中。  
    		byte[] mac = NetworkInterface.getByInetAddress(ia).getHardwareAddress();
    		System.out.println("小杨逗比，mac数组长度："+mac.length);
    		StringBuffer sb = new StringBuffer("");
    		for(int i=0; i<mac.length; i++) {
    			if(i!=0) {
    				sb.append("-");
    			}
    			//mac[i] & 0xFF 是为了把byte转化为正整数  
    			int temp = mac[i]&0xff;
    			String str = Integer.toHexString(temp);
    			System.out.println("每8位:"+str);
    			if(str.length()==1) {
    				sb.append("0"+str);
    			}else {
    				sb.append(str);
    			}
    		}
    		System.out.println("小杨逗比本机MAC地址:"+sb.toString().toUpperCase());
    	}
    }
    ```
- 命令行获取MAC地址
    - 在cmd 命令行中，我们可以通过 nbtstat -a [IP]命令就可以获取到MAC地址
- 获取不到的问题
    - 网线没连接好，先看看能否ping通
    - 是否在策略组设置了禁止外部访问获取的权限
    - 是否防火墙拦截
    - 是否中病毒，或者有防水坝系统等拦截




### 08.总结一下
- DNS 是网络世界的地址簿
    - 可以通过域名查地址，因为域名服务器是按照树状结构组织的，因而域名查找是使用递归的方法，并通过缓存的方式增强性能；
    - 在域名和 IP 的映射过程中，给了应用基于域名做负载均衡的机会，可以是简单的负载均衡，也可以根据地址和运营商做全局的负载均衡。


### 其他介绍
#### 01.关于博客汇总链接
- 1.[技术博客汇总](https://www.jianshu.com/p/614cb839182c)
- 2.[开源项目汇总](https://blog.csdn.net/m0_37700275/article/details/80863574)
- 3.[生活博客汇总](https://blog.csdn.net/m0_37700275/article/details/79832978)
- 4.[喜马拉雅音频汇总](https://www.jianshu.com/p/f665de16d1eb)
- 5.[其他汇总](https://www.jianshu.com/p/53017c3fc75d)



#### 02.关于我的博客
- 我的个人站点：
- github：https://github.com/yangchong211
- 简书：http://www.jianshu.com/u/b7b2c6ed9284
- csdn：http://my.csdn.net/m0_37700275
- 喜马拉雅听书：http://www.ximalaya.com/zhubo/71989305/
- 开源中国：https://my.oschina.net/zbj1618/blog
- 泡在网上的日子：http://www.jcodecraeer.com/member/content_list.php?channelid=1
- 邮箱：yangchong211@163.com
- 阿里云博客：https://yq.aliyun.com/users/article?spm=5176.100- 239.headeruserinfo.3.dT4bcV
- segmentfault头条：https://segmentfault.com/u/xiangjianyu/articles
- 掘金：https://juejin.im/user/5939433efe88c2006afa0c6e











