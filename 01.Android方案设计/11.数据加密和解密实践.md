# 11.数据加密和解密实践
#### 目录介绍
- 01.加解密基础概念
  - 1.2 加解密算法分类
- 02.加解密使用场景
  - 2.1 单向加密算法
  - 2.2 对称加密算法
  - 2.3 非对称加密算法
- 03.MD5加密设计
  - 3.1 MD5算法摘要
  - 3.2 MD5算法特点
  - 3.3 MD5使用场景
  - 3.4 注意事项说明
  - 3.5 MD5如何破解
- 04.Base64加解密
  - 4.1 为何要Base64
  - 4.2 Base64编码说明
  - 4.3 Base64基本规则
- 05.SHA哈希函数
  - 5.1 Hash算法说明
- 06.DES对称加解密
- 07.AES对称加解密
- 08.RC4对称加解密
  - 8.1 RC4算法介绍
- 09.RSA非对称加解密
  - 9.1 RSA算法介绍
  - 9.2 RSA核心原理
  - 9.3 理解密钥生成
  - 9.4 加解密过程
- 10.DSA非对称加解密
- 11.SM国密算法
  - 11.1 SM加密是什么
  - 11.2 SM2算法介绍
  - 11.3 SM3算法介绍
  - 11.4 SM4算法介绍
  - 11.5 OpenSsl与SM
- 12.遇到的一些问题
  - 12.1 ASCII不可见字符


## 01.加解密基础概念

### 1.2 加解密算法分类

数据加解密算法有很多种，其中一些常见的包括：

1. **对称加密算法：**

- **AES（Advanced Encryption Standard）**：一种流行的对称加密算法，用于加密和解密数据。
- **DES（Data Encryption Standard）**：较为古老的对称加密算法，已逐渐被 AES 取代。
- **3DES（Triple Data Encryption Standard）**：对 DES 进行三次加密以增强安全性。

2. **非对称加密算法：**

- **RSA（Rivest-Shamir-Adleman）**：一种常见的非对称加密算法，用于加密和数字签名。
- **DSA（Digital Signature Algorithm）**：专门用于数字签名的非对称加密算法。
- **ECC（Elliptic Curve Cryptography）**：基于椭圆曲线的非对称加密算法，具有较高的安全性和效率。

3. **哈希函数：**

- **MD5（Message Digest Algorithm 5）**：一种常见的哈希函数，用于生成固定长度的哈希值。
- **SHA（Secure Hash Algorithm）系列**：包括 SHA-1、SHA-256、SHA-512 等不同长度的哈希函数。

4. **密码学协议：**

- **TLS/SSL（Transport Layer Security/Secure Sockets Layer）**：用于安全通信的协议，包括对称加密、非对称加密和数字证书等技术。
- **PGP（Pretty Good Privacy）**：用于加密、签名和认证的开放标准。

这些是一些常见的数据加解密算法和技术，用于保护数据的机密性、完整性和认证性。在实际应用中，根据需求和安全性要求，选择适合的加密算法和协议非常重要。

## 02.加解密使用场景

### 2.1 单向加密算法

输入明文后由算法直接加密成密文，密文无法解密，只有重新输入密文，并经过同样的加密算法处理，得到形同的密文并被系统重新识别后，才能真正的解密。

### 2.2 对称加密算法

**一句话概括：加密和解密都是用相同密钥**。这类加密算法技术较为成熟，加密效率高。

- 密钥可以自己指定，只有一把密钥，如果密钥暴露，文件就会被暴露。
- 特点是加密速度很快，但是缺点是安全性较低，因为只要密钥暴漏，数据就可以被解密了。

常见的对称加密和解密：DES算法；AES算法

### 2.3 非对称加密算法

收发双方使用不同的密钥，发方使用公开密钥对消息进行加密，收发使用私有密钥机型解密，保密性更高，但效率更低。

加密和解密的规则是：**公钥加密只能私钥解密，私钥加密只能公钥解密**。特点是加密速度慢些，但是安全系数很高

应用场景举例：在集成支付宝支付sdk时，需要生成私钥和公钥，公钥需要设置到支付宝网站的管理后台，在程序中调用支付接口的时候，使用我们自己的私钥进行加密，这样支付宝由于有公钥可以解密，其他人即时劫持了数据，但是没有公钥，也无法解密。

常见非对称加密：RSA

## 03.MD5加密设计

### 3.1 MD5算法摘要

信息-摘要算法。用于确保信息传输完整一致。是计算机广泛使用的杂凑算法之一（又译摘要算法、哈希算法），主流编程语言普遍已有MD5实现。

### 3.2 MD5算法特点

MD5算法具有特点，如下所示：

- 1、压缩性：任意长度的数据，算出的MD5值长度都是固定的。
- 2、容易计算：从原数据计算出MD5值很容易。
- 3、抗修改性：对原数据进行任何改动，哪怕只修改1个字节，所得到的MD5值都有很大区别。
- 4、强抗碰撞：已知原数据和其MD5值，想找到一个具有相同MD5值的数据（即伪造数据）是非常困难的。
- 5、MD5加密是不可逆的。

### 3.3 MD5使用场景

1.用户登录的时候，系统把用户输入的password计算成MD5值，然后保存该值，每次用户输入密码用md5对比即可知道密码是否正确。

2.文件的完整性校验，在传递文件的过程中附带传递文件的md5值，接收端通过比较文件的md5值判断文件的完整性。

### 3.4 注意事项说明

注意事项说明，由于网络MD5数据库比较大，如果直接使用md5加密的话，可能会被破译出来，这是在加密的过程中”加盐”就可以大大避免直接被破译的危险。

### 3.5 MD5如何破解



## 04.Base64加解密

### 4.1 为何要Base64

为何很多对称和非对称加密解密还要对数据base64处理？

各种数据加密方式，最终都会对加密后的二进制数据进行Base64编码，起到一种二次加密的效果，其实Base64从严格意义上来说的话不是一种加密算法，而是一种编码算法，为何要使用Base64编码呢？它解决了什么问题？

在计算机中任何数据都是按ascii码存储的，而ascii码的128～255之间的值是不可见字符。而在网络上交换数据时，比如说从A地传到B地，往往要经过多个路由设备，由于不同的设备对字符的处理方式有一些不同，这样那些不可见字符就有可能被处理错误，这是不利于传输的。所以就先把数据先做一个Base64编码，统统变成可见字符，这样出错的可能性就大降低了。

1. 文本传输：在网络传输或存储数据时，某些数据可能包含不可打印字符或特殊字符，这可能会导致数据传输错误或解析问题。通过将数据转换为 Base64 编码，可以确保数据只包含可打印字符，从而更容易传输和处理。
2. 数据格式化： 在某些情况下，需要将二进制数据转换为文本格式，以便在不同系统之间进行交换。Base64 编码可以将二进制数据转换为文本格式，使其更易于处理和传输。
3. 数据隐藏： 在一些场景下，需要隐藏原始数据的内容。虽然 Base64 编码并不是加密，但它可以将数据转换为一种不易直接识别的形式，增加数据的保密性。
4. 数据完整性： 在某些情况下，需要确保数据在传输过程中不被篡改。通过对数据进行 Base64 编码，可以更容易地检测数据是否被篡改，因为 Base64 编码后的数据长度通常是固定的。

### 4.2 Base64编码说明

Base64是网络上最常见的用于传输8Bit字节代码的编码方式之一

Base64并不是安全领域的加密算法，其实Base64只能算是一个编码算法，对数据内容进行编码来适合传输。准确说是把一些二进制数转成普通字符用于网络传输。

**Base64编码本质上是一种将二进制数据转成文本数据的方案**

对于非二进制数据，是先将其转换成二进制形式，然后每连续6比特（2的6次方=64）计算其十进制值，根据该值在A--Z,a--z,0--9,+,/ 这64个字符中找到对应的字符，最终得到一个文本字符串。

### 4.3 Base64基本规则

标准Base64只有64个字符（英文大小写、数字和+、/）以及用作后缀等号；

Base64是把3个字节变成4个可打印字符，所以Base64编码后的字符串一定能被4整除（不算用作后缀的等号）；

等号一定用作后缀，且数目一定是0个、1个或2个。这是因为如果原文长度不能被3整除，Base64要在后面添加\0凑齐3n位。为了正确还原，添加了几个\0就加上几个等号。显然添加等号的数目只能是0、1或2；

严格来说Base64不能算是一种加密，只能说是编码转换。

## 05.SHA哈希函数

### 5.1 Hash算法说明

- 散列算法是什么
    - 是把任意长度的输入（又叫做预映射 pre-image ）通过算法变换成固定长度的输出。散列是信息的提炼，通常其长度要比信息小得多，且为一个固定长度。
- 特性：
    - 1.高效：可以快速计算出哈希值；2.不可逆：从哈希值不能反向推导出原始数据；3.输入敏感：原始数据只要有一点变动，得到的哈希值也会差别很大；4.冲突避免：对于不同的原始数据，哈希值相同的概率非常小。
- 使用场景：
    - 安全加密。 例如网络传输密码。
    - 唯一标识。例如在海量的图库中，搜索一张图是否存在。可以给每一个图片取一个唯一标识，或者说信息摘要，通过这个唯一标识来判定图片是否在图库中，这样就可以减少很多工作量
    - 数据校验。例如下载文件的完整性
    - 负载均衡。通过哈希算法，对客户端 IP 地址或者会话 ID 计算哈希值，将取得的哈希值与服务器个数进行取模运算，最终得到的值就是应该被路由到的服务器编号
- Hash算法常见案例(MD5、SHA1、SHA256)：
    - MD4 1990年，输出128位 （已经不安全）
    - MD5 1991年，输出128位 （已经不安全）
    - SHA-0 1993年，输出160位 （发布之后很快就被撤回，是SHA-1的前身）
    - SHA-1 1995年，输出160位 （已经不安全）
    - SHA-2 包括 SHA-224、SHA-256、SHA-384，和 SHA-512，分别输出 224、256、384、512位。 (目前安全)


## 08.RC4对称加解密
### 8.1 RC4算法介绍

- RC4算法
    - RC4是一种对称密码算法，它属于对称密码算法中的序列密码(streamcipher,也称为流密码)，它是可变密钥长度，面向字节操作的流密码。
- RC4算法特点：
    - (1)、算法简洁易于软件实现，加密速度快，安全性比较高(在存储大量的信息时，RC4展现出它的实用性，面对大量的数据，运行简单，速度快)；
    - (2)、密钥长度可变，一般用256个字节。
- RC4工作规则
    - 第一步：输入密钥+需要加密的信息；第二步：通过密钥逐字节的对信息进行加密；第三步：接收方通过密钥解密数据

## 09.RSA非对称加解密
### 9.1 RSA算法介绍


### 9.2 RSA核心原理


### 9.3 理解密钥生成

在 Java 中，可以使用 KeyPairGenerator 生成 RSA 密钥对：

``` java
// 创建 KeyPairGenerator 实例
KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
keyPairGenerator.initialize(2048); // 设置密钥长度，密钥长度范围：512～2048

// 生成密钥对
KeyPair keyPair = keyPairGenerator.generateKeyPair();

// 获取公钥和私钥
System.out.println("Public Key: " + keyPair.getPublic());
System.out.println("Private Key: " + keyPair.getPrivate());
```


### 9.4 加解密过程


## 11.SM国密算法

### 11.1 SM加密是什么

- 国密即国家密码局认定的国产密码算法。
    - 主要有SM1，SM2，SM3，SM4和最新的sm9。在国内环境主要使用的国家密码局认定的算法。
- 主要包含SM1、SM2、SM3、SM4几种方式。
    - SM1：对称加密，且算法不公开，使用硬件加密，本文不做叙述；
    - SM2：非对称加密，签名以及生成秘钥速度优于RSA，基于ECC算法，运算效率更高，且更安全；
    - SM3：摘要，国产杂凑算法，生成长度为256比特，优于MD5以及SHA-1算法；
    - SM4： 无线局域网标准的分组数据算法。对称加密，密钥长度和分组长度均为128位；

- SM替代算法核心
    - 对称算法： （DES 3DES AES）===》  SM1、SM4【其中SM1依赖硬件，因此不予实现，也未公开】
    - 非对称密码算法： (RSA)  ===》 SM2(椭圆曲线密码)
    - 散列算法： (MD5、SHA-1、SHA-256、SHA-384、SHA512)  ===》 SM3


- SM算法实现应用说明
    - SM2：创建密钥对、获取公钥、获取私钥、加密、解密、签名、验签
    - SM3：加密
    - SM4：创建秘钥、加密、解密

### 11.2 SM2算法介绍

- SM2算法介绍
    - SM2椭圆曲线公钥密码算法是我国自主设计的公钥密码算法，包括SM2-1椭圆曲线数字签名算法，SM2-2椭圆曲线密钥交换协议，SM2-3椭圆曲线公钥加密算法，分别用于实现数字签名密钥协商和数据加密等功能。


### 11.3 SM3算法介绍

- SM3算法介绍
    - SM3杂凑算法是我国自主设计的密码杂凑算法，适用于商用密码应用中的数字签名和验证消息认证码的生成与验证以及随机数的生成，可满足多种密码应用的安全需求。
- 可以类比MD5算法
    - 与MD5相似，但是比md5更长，具有更高的安全性。

### 11.4 SM4算法介绍

- SM4算法介绍
    - 分组密码算法是我国自主设计的分组对称密码算法，用于实现数据的加密/解密运算，以保证数据和信息的机密性。
    - 要保证一个对称密码算法的安全性的基本条件是其具备足够的密钥长度，SM4算法与AES算法具有相同的密钥长度分组长度128比特，因此在安全性上高于3DES算法。
- 可以类比AES算法
    - 与AES相似。

### 11.5 OpenSsl与SM

- 使用openssl实现SM算法
    - 在算法实现中，不免要使用openssl库来进行操作，openssl 很强大，提供了健壮的，全功能的加密套件。
    - 有兴趣的同学可以详细去学习下，openssl有着大量的API可以使用，可以实现大量的密码算法。




## 12.遇到的一些问题

### 12.1 ASCII不可见字符

- ASCII码是什么东西
    - ASCII（美国信息交换标准代码）是基于拉丁字母的一套电脑编码系统，主要用于显示现代英语和其他西欧语言。
- 关于控制台复制文本被截断，不能全部复制出来的问题。
    - 这是由于ASCII编码字符的“不可见字符”导致，不可见字符为控制字符，例如换行，回车等等。
- 有时候也把不可见字符叫做转义字符
    - C语言中定义了一些字母前加""来表示常见的那些不能显示的ASCII字符，如代码用的\t、\n等，就称为转义字符，因为该字符都不是它本来的ASCII字符意思。



- Android常见网络数据加密：https://www.jianshu.com/p/f1081e7a6e20
- Android数据加密概述及多种加密方式：https://www.cnblogs.com/zsychanpin/p/7308866.html
- Android传输数据时加密详解：https://cloud.tencent.com/developer/article/2086547
- 使用RSA分段加解密：https://blog.csdn.net/dongaddxing/article/details/116041314
- Android应用安全开发之浅谈加密算法的坑: https://www.lmlphp.com/user/58551/article/item/645568/


