
#### 2.2 存储日志信息设计
- 比如，打印日志如下所示：
    - LogUtils.i("Log test info : click text view test")
- 日志组装后输出到控制台
    - yc_log:: [(LogTestActivity.kt:110)#OnClick] Log test info : click text view test
    - 携带方法和的类的源文件行号，支持点击跳转到源文件。
- 那么如何组装数据
    - 获取当前堆栈信息，然后获取指定索引处的className和methodName。也就是：(LogTestActivity.kt:110)#OnClick
    - 从中获取方法执行的线程相关的信息，以及执行的方法名称等。这些信息能帮助我们更好的查找问题之所在。


#### 2.5 存储数据队列设计
- 采集一次日志就保存到file文件中吗
    - 这个采集过程，如果是每产生一次日志数据，就写一次文件，势必造成系统IO调用的频繁操作，可能会造成app运行卡顿现象。因此采用队列保存日志，当达到某数值则开始写入到文件，简单来说是追加写入。
- 队列缓存大小，单位(条)，也可以动态修改容积。
    - 比如进入日志高频触发区，则将缓存容积扩大到100条，进入低频触发区就缩小到10条。容积缩小时，如果缓存内条目数已经大于目标条数，自动触发flush。
- 在初始化的时候，创建一个日志队列线程并开始
    - 开启while循环，从日志队列取数据，如果有数据则doFlush()发送到LogService，通过Aidl进行数据发送。



#### 2.6 如何写数据的设计




#### 2.4 组装log日志设计



#### 2.5 日志文件创建机制



#### 2.6 日志缓存的策略


#### 2.8 日志存储GZip压缩
- https://juejin.cn/post/7083634028640731143


#### 2.9 多进程存储问题


### 03.关键技术点说明




#### 3.2 跨进程启动服务


#### 3.3 跨进程传输日志


#### 3.4 日志写入操作


### 04.使用高效日志库
#### 4.1 高效日志方案
- 移动日志系统使用了Linux系统中提供的mmap作为日志文件的载体
    - 目前业内流行的XLOG日志组件、MMKV、美团Logan均采用了此方案，其最大的优势就是高效I/O、低损耗、跨进程 等优势。


#### 4.3 移动端使用mmap
- 对于移动端日志采集SDK来说
    - 主要进行的工作就是将用户写入的数据保存到文件中，在这个过程中涉及到在native层调用mmap函数实现在进程虚拟内存地址空间中分配地址空间，创建和物理内存的映射关系。


#### 4.4 XLog介绍



#### 4.5 Logan介绍
- 大概的原理介绍
    - Logan通过Native方式来实现日志底层的核心逻辑，也就是C编写底层库。收集日志时，在C层实现流式的压缩和加密数据，可以减少CPU峰值，使程序运行更加顺滑。而且先压缩再加密的方式压缩率比较高，整体效率较高。加密方式为AES。
    - Logan对日志协议数据进行格式化处理，针对大日志的分片处理，引入了MMAP机制解决了日志丢失问题，使用AES进行日志加密确保日志安全性。  
- 使用mmap技术优化
    - mmap: 是一种内存映射文件的方法，它将一个文件映射到进程的地址空间中，实现文件磁盘地址和进程虚拟地址空间中一段虚拟地址的一一对映关系
    - 实现这样的映射关系后，进程就可以采用指针的方式读写操作这一段内存，而系统会自动回写脏页面到对应的文件磁盘上
      











